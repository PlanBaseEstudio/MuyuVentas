<!-- MOD-001: ENCABEZADO [INICIO] -->
<!--
*****************************************
PROYECTO: Muyu Ventas
ARCHIVO: Movilw.html
VERSI√ìN: 01.03
FECHA: 22/02/2026 23:51 (UTC-5)
*****************************************
-->
<!-- MOD-001: FIN -->

<!-- MOD-002: APERTURA HTML [INICIO] -->
<!DOCTYPE html>
<html lang="es">
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title>Venta M√≥vil</title>
<!-- MOD-002: FIN -->

<!-- MOD-003: ESTILOS CSS [INICIO] -->
    <style>
/* MOD-003-001: RESET Y BODY BASE [INICIO] */
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        background: #f0f2f5;
        padding-bottom: 20px;
      }
/* MOD-003-001: FIN */

/* MOD-003-002: BOT√ìN HOME [INICIO] */
      .btn-home {
        position: fixed;
        top: 12px;
        left: 12px;
        background: #667eea;
        color: white;
        padding: 8px 14px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 13px;
        font-weight: 600;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        transition: all 0.3s ease;
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 6px;
        text-decoration: none;
      }
      .btn-home:hover {
        background: #5568d3;
        transform: translateY(-2px);
      }
/* MOD-003-002: FIN */

/* MOD-003-003: CONTAINER PRINCIPAL + T√çTULO [INICIO] */
      .container {
        width: 100%;
        max-width: 480px;
        margin: 56px auto 20px;
        background: #fff;
        padding: 14px;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      }
      h2 {
        text-align: center;
        margin-bottom: 14px;
        color: #333;
        font-size: 1.2rem;
      }
/* MOD-003-003: FIN */

/* MOD-003-004: SECCI√ìN COLAPSABLE [INICIO] */
      .seccion-colapsable {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        margin-bottom: 10px;
        overflow: hidden;
      }
      .seccion-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 9px 12px;
        cursor: pointer;
        user-select: none;
      }
      .seccion-header span.titulo {
        font-weight: 600;
        font-size: 13px;
        color: #495057;
      }
      .seccion-header span.flecha {
        font-size: 12px;
        color: #888;
        transition: transform 0.25s ease;
      }
      .seccion-header span.flecha.colapsado {
        transform: rotate(-90deg);
      }
      .seccion-contenido {
        padding: 8px 10px 10px;
        border-top: 1px solid #dee2e6;
      }
      .seccion-contenido.oculto {
        display: none;
      }
      /* Secci√≥n fija (no colapsable) para Medios de Pago */
      .seccion-fija {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        margin-bottom: 10px;
        padding: 9px 12px 10px;
      }
      .seccion-fija span.titulo {
        display: block;
        font-weight: 600;
        font-size: 13px;
        color: #495057;
        margin-bottom: 8px;
      }
/* MOD-003-004: FIN */

/* MOD-003-005: BOTONES CATEGOR√çA [INICIO] */
      .botones-categoria {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(72px, 1fr));
        gap: 6px;
      }
      .btn-categoria {
        padding: 7px 6px;
        font-size: 12px;
        border: 3px solid transparent;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-weight: bold;
        color: #ffffff;
        text-align: center;
        line-height: 1.2;
      }
      .btn-categoria:nth-child(1)  { background: #e74c3c; }
      .btn-categoria:nth-child(2)  { background: #3498db; }
      .btn-categoria:nth-child(3)  { background: #2ecc71; }
      .btn-categoria:nth-child(4)  { background: #9b59b6; }
      .btn-categoria:nth-child(5)  { background: #f39c12; }
      .btn-categoria:nth-child(6)  { background: #1abc9c; }
      .btn-categoria:nth-child(7)  { background: #e67e22; }
      .btn-categoria:nth-child(8)  { background: #34495e; }
      .btn-categoria:nth-child(9)  { background: #16a085; }
      .btn-categoria:nth-child(10) { background: #c0392b; }
      .btn-categoria:nth-child(11) { background: #8e44ad; }
      .btn-categoria:nth-child(12) { background: #2980b9; }
      .btn-categoria:nth-child(13) { background: #27ae60; }
      .btn-categoria:nth-child(14) { background: #d35400; }
      .btn-categoria:nth-child(15) { background: #7f8c8d; }
      .btn-categoria.activo {
        border: 3px solid #000;
        box-shadow: 0 4px 12px rgba(0,0,0,0.25);
        transform: scale(1.06);
      }
/* MOD-003-005: FIN */

/* MOD-003-006: BOTONES MEDIO PAGO [INICIO] */
      .botones-medios-pago {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        justify-content: center;
      }
      .btn-medio-pago {
        padding: 9px 18px;
        font-size: 14px;
        border: 3px solid transparent;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-weight: bold;
        flex: 1;
        min-width: 80px;
        text-align: center;
      }
      .btn-medio-pago[data-medio="Efectivo"] { background: #4CAF50; color: #fff; }
      .btn-medio-pago[data-medio="Yape"]     { background: #9117A0; color: #fff; }
      .btn-medio-pago[data-medio="Tarjeta"]  { background: #3498db; color: #fff; }
      .btn-medio-pago.activo {
        border: 3px solid #000;
        box-shadow: 0 4px 12px rgba(0,0,0,0.25);
        transform: scale(1.05);
      }
/* MOD-003-006: FIN */

/* MOD-003-007: VENTA CARD FLEXBOX [INICIO] */
      .lista-ventas {
        margin-bottom: 12px;
      }
      .venta-card {
        display: flex;
        align-items: stretch;
        border-top: 2px solid #1a73e8;
        background: #f7f9ff;
        margin-bottom: 2px;
        border-radius: 0 0 6px 6px;
        padding: 6px 4px 8px;
        gap: 6px;
      }
      .venta-card:last-child {
        border-bottom: 1px solid #d0d0d0;
      }
      .venta-num {
        width: 22px;
        flex-shrink: 0;
        text-align: center;
        font-weight: bold;
        font-size: 15px;
        color: #1a73e8;
        padding-top: 6px;
      }
      .venta-col-izq {
        width: 150px;
        flex-shrink: 0;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      .venta-col-der {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      .venta-del {
        width: 34px;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
      }
/* MOD-003-007: FIN */

/* MOD-003-008: ETIQUETAS CAMPO [INICIO] */
      .num-fila {
        text-align: center;
        font-weight: bold;
        font-size: 15px;
        color: #1a73e8;
      }
      .campo-label {
        display: block;
        font-size: 10px;
        font-weight: 600;
        color: #888;
        margin-bottom: 1px;
        text-transform: uppercase;
        letter-spacing: 0.4px;
      }
/* MOD-003-008: FIN */

/* MOD-003-009: INPUTS Y SELECTS [INICIO] */
      input, select {
        width: 100%;
        padding: 6px 5px;
        font-size: 13px;
        border: 1px solid #ccc;
        border-radius: 6px;
        box-sizing: border-box;
      }
      input[type="number"] { text-align: right; }
      input[readonly] {
        background: #f0f0f0;
        cursor: not-allowed;
        font-weight: 600;
        color: #1a73e8;
        border-color: #b0c8f0;
      }
/* MOD-003-009: FIN */

/* MOD-003-010: CONTROLES CANTIDAD +/- [INICIO] */
      .cantidad-ctrl {
        display: flex;
        align-items: center;
        gap: 3px;
      }
      .btn-cant {
        background: #1a73e8;
        color: white;
        border: none;
        border-radius: 5px;
        width: 28px;
        height: 28px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 1;
        padding: 0;
      }
      .btn-cant:hover { background: #1558b0; }
      .btn-cant:active { transform: scale(0.93); }
      .input-cantidad {
        width: 40px !important;
        text-align: center !important;
        padding: 4px 2px !important;
        font-size: 13px;
        flex-shrink: 0;
      }
/* MOD-003-010: FIN */

/* MOD-003-011: SUBTOTAL FILA [INICIO] */
      .subtotal-wrap {
        display: flex;
        align-items: center;
        gap: 4px;
        white-space: nowrap;
      }
      .igual-signo {
        font-weight: bold;
        color: #555;
        font-size: 13px;
      }
      .input-subtotal {
        width: 58px !important;
        font-size: 12px !important;
        padding: 4px 3px !important;
      }
/* MOD-003-011: FIN */

/* MOD-003-012: BOT√ìN ELIMINAR FILA [INICIO] */
      .btn-eliminar-fila {
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        text-decoration: none;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .btn-eliminar-fila:hover { background: #c82333; }
/* MOD-003-012: FIN */

/* MOD-003-013: RESUMEN TOTAL [INICIO] */
      .resumen-total {
        text-align: right;
        padding: 12px 14px;
        margin-bottom: 12px;
        background: #e7f3ff;
        border-radius: 8px;
        border-left: 4px solid #1a73e8;
      }
      .resumen-total .label {
        font-size: 13px;
        color: #495057;
        font-weight: 600;
      }
      .resumen-total .monto {
        font-size: 22px;
        color: #1a73e8;
        font-weight: bold;
        margin-top: 3px;
      }
/* MOD-003-013: FIN */

/* MOD-003-014: BOTONES AGREGAR / GUARDAR / LIMPIAR [INICIO] */
      .botones-filas {
        display: flex;
        gap: 8px;
        margin-bottom: 12px;
        justify-content: center;
      }
      .btn-agregar {
        background: #28a745;
        color: white;
        border: none;
        border-radius: 8px;
        padding: 10px 20px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
        width: 100%;
      }
      .btn-agregar:hover { background: #218838; }
      .botones-principales {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .btn-guardar {
        flex: 1;
        min-width: 130px;
        padding: 14px;
        font-size: 16px;
        font-weight: 600;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        background: #1a73e8;
        color: white;
        transition: background 0.2s;
      }
      .btn-guardar:hover { background: #1558b0; }
      .btn-limpiar {
        flex: 1;
        min-width: 130px;
        padding: 14px;
        font-size: 16px;
        font-weight: 600;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        background: #5f6368;
        color: white;
        transition: background 0.2s;
      }
      .btn-limpiar:hover { background: #4a4d51; }
/* MOD-003-014: FIN */

/* MOD-003-015: MENSAJES √âXITO/ERROR [INICIO] */
      #mensajeExito {
        margin-top: 12px;
        padding: 13px;
        font-size: 15px;
        font-weight: 600;
        text-align: center;
        border-radius: 8px;
        display: none;
      }
      .ok    { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
      .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
/* MOD-003-015: FIN */
    </style>
<!-- MOD-003: FIN -->

<!-- MOD-004: JAVASCRIPT [INICIO] -->
    <script>
// MOD-004-001: VARIABLES GLOBALES [INICIO]
      let categorias = [];
      let categoriasBoton = [];
      let mediosPago = [];
      let contadorFilas = 3;
      let categoriaSeleccionada = null;
      let medioPagoSeleccionado = null;
// MOD-004-001: FIN

// MOD-004-002: CARGAR LISTAS GAS [INICIO]
      function cargarListas() {
        google.script.run.withSuccessHandler(function(cats) {
          categorias = cats;
          llenarSelects();
        }).getCategorias();

        google.script.run.withSuccessHandler(function(catsBoton) {
          categoriasBoton = catsBoton;
          crearBotonesCategorias();
        }).getCategoriasBoton();

        google.script.run.withSuccessHandler(function(pagos) {
          mediosPago = pagos;
          llenarSelects();
          crearBotonesMediosPago();
        }).getMediosPago();
      }
// MOD-004-002: FIN

// MOD-004-003: TOGGLE SECCI√ìN COLAPSABLE [INICIO]
      function toggleSeccion(idContenido, idFlecha) {
        const contenido = document.getElementById(idContenido);
        const flecha = document.getElementById(idFlecha);
        contenido.classList.toggle('oculto');
        flecha.classList.toggle('colapsado');
      }
// MOD-004-003: FIN

// MOD-004-004: CREAR BOTONES CATEGOR√çAS [INICIO]
      function crearBotonesCategorias() {
        if (categoriasBoton.length === 0) return;
        const contenedor = document.getElementById('botonesCategoria');
        contenedor.innerHTML = '';
        categoriasBoton.forEach(item => {
          const boton = document.createElement('button');
          boton.type = 'button';
          boton.className = 'btn-categoria';
          boton.setAttribute('data-categoria', item.categoria);
          boton.textContent = item.boton;
          boton.onclick = () => seleccionarCategoria(item.categoria, boton);
          contenedor.appendChild(boton);
        });
      }
// MOD-004-004: FIN

// MOD-004-005: SELECCIONAR CATEGOR√çA + APLICAR A TODOS [INICIO]
      function seleccionarCategoria(categoria, botonClickeado) {
        document.querySelectorAll('.btn-categoria').forEach(btn => btn.classList.remove('activo'));
        botonClickeado.classList.add('activo');
        categoriaSeleccionada = categoria;
        document.querySelectorAll('.fila-grupo').forEach(card => {
          const id = card.getAttribute('data-id');
          const sel = document.getElementById('categoria' + id);
          if (sel) {
            sel.value = categoria;
            cargarSugerenciasCategoria(id);
          }
        });
      }
// MOD-004-005: FIN

// MOD-004-006: CREAR BOTONES MEDIOS PAGO [INICIO]
      function crearBotonesMediosPago() {
        if (mediosPago.length === 0) return;
        const contenedor = document.getElementById('botonesMediosPago');
        contenedor.innerHTML = '';
        mediosPago.forEach(medio => {
          const boton = document.createElement('button');
          boton.type = 'button';
          boton.className = 'btn-medio-pago';
          boton.setAttribute('data-medio', medio);
          boton.textContent = medio;
          boton.onclick = () => seleccionarMedioPago(medio, boton);
          contenedor.appendChild(boton);
        });
      }
// MOD-004-006: FIN

// MOD-004-007: SELECCIONAR MEDIO PAGO + APLICAR A TODOS [INICIO]
      function seleccionarMedioPago(medio, botonClickeado) {
        document.querySelectorAll('.btn-medio-pago').forEach(btn => btn.classList.remove('activo'));
        botonClickeado.classList.add('activo');
        medioPagoSeleccionado = medio;
        document.querySelectorAll('.fila-grupo').forEach(card => {
          const id = card.getAttribute('data-id');
          const sel = document.getElementById('medioPago' + id);
          if (sel) sel.value = medio;
        });
      }
// MOD-004-007: FIN

// MOD-004-008: LLENAR SELECTS [INICIO]
      function llenarSelects() {
        if (categorias.length === 0 || mediosPago.length === 0) return;
        document.querySelectorAll('.fila-grupo').forEach(card => {
          const id = card.getAttribute('data-id');
          const selectCat  = document.getElementById('categoria' + id);
          const selectPago = document.getElementById('medioPago' + id);
          if (!selectCat || !selectPago) return;
          const catActual  = selectCat.value;
          const pagoActual = selectPago.value;

          selectCat.innerHTML  = '<option value="">Sin categor√≠a</option>';
          selectPago.innerHTML = '<option value="">Seleccionar Pago</option>';

          categorias.forEach(cat => {
            const o = document.createElement('option');
            o.value = cat; o.text = cat;
            selectCat.appendChild(o);
          });
          mediosPago.forEach(pg => {
            const o = document.createElement('option');
            o.value = pg; o.text = pg;
            selectPago.appendChild(o);
          });

          selectCat.value  = catActual;
          selectPago.value = pagoActual;
        });
      }
// MOD-004-008: FIN

// MOD-004-009: CALCULAR TOTAL FILA + TOTAL GENERAL [INICIO]
      function calcularTotal(id) {
        const precio   = parseFloat(document.getElementById('precioUnitario' + id).value) || 0;
        const cantidad = parseFloat(document.getElementById('cantidad' + id).value) || 0;
        const subtotalEl = document.getElementById('total' + id);
        if (subtotalEl) subtotalEl.value = (precio * cantidad).toFixed(2);
        actualizarTotalGeneral();
      }

      function actualizarTotalGeneral() {
        let total = 0;
        document.querySelectorAll('.fila-grupo').forEach(grupo => {
          const id = grupo.getAttribute('data-id');
          total += parseFloat(document.getElementById('total' + id)?.value) || 0;
        });
        document.getElementById('totalGeneral').textContent = 'S/ ' + total.toFixed(2);
      }
// MOD-004-009: FIN

// MOD-004-010: CAMBIAR CANTIDAD CON BOTONES +/- [INICIO]
      function cambiarCantidad(id, delta) {
        const input = document.getElementById('cantidad' + id);
        const actual = Math.floor(parseFloat(input.value) || 0);
        const nuevo  = actual + delta;
        if (nuevo < 1) return;
        input.value = nuevo;
        calcularTotal(id);
      }
// MOD-004-010: FIN

// MOD-004-011: AGREGAR FILA [INICIO]
      function agregarFila() {
        contadorFilas++;
        const id = contadorFilas;
        const lista = document.getElementById('listaVentas');

        const card = document.createElement('div');
        card.className = 'venta-card fila-grupo';
        card.setAttribute('data-id', id);
        card.innerHTML = `
          <div class="venta-num">${id}</div>
          <div class="venta-col-izq">
            <span class="campo-label">Categor√≠a</span>
            <select id="categoria${id}" onchange="cargarSugerenciasCategoria(${id})"></select>
            <span class="campo-label" style="margin-top:4px;">Medio de Pago</span>
            <select id="medioPago${id}"></select>
          </div>
          <div class="venta-col-der">
            <input type="text" id="producto${id}" list="sugerencias${id}" placeholder="Producto">
            <input type="number" id="precioUnitario${id}" step="any" min="0.01" placeholder="S/ Precio" oninput="calcularTotal(${id})">
            <div class="cantidad-ctrl">
              <button type="button" class="btn-cant" onclick="cambiarCantidad(${id},-1)">‚àí</button>
              <input type="number" id="cantidad${id}" class="input-cantidad" value="1" step="any" min="0.01" oninput="calcularTotal(${id})">
              <button type="button" class="btn-cant" onclick="cambiarCantidad(${id},1)">+</button>
              <span class="igual-signo">=</span>
              <input type="text" id="total${id}" class="input-subtotal" readonly>
            </div>
          </div>
          <div class="venta-del">
            <a href="javascript:void(0)" class="btn-eliminar-fila" onclick="eliminarFila(${id})">üóëÔ∏è</a>
          </div>`;

        lista.appendChild(card);
        llenarSelects();
        if (categoriaSeleccionada) {
          const s = document.getElementById('categoria' + id);
          if (s) { s.value = categoriaSeleccionada; cargarSugerenciasCategoria(id); }
        }
        if (medioPagoSeleccionado) {
          const s = document.getElementById('medioPago' + id);
          if (s) s.value = medioPagoSeleccionado;
        }
        renumerarFilas();
      }
// MOD-004-011: FIN

// MOD-004-012: ELIMINAR FILA + RENUMERAR [INICIO]
      function eliminarFila(id) {
        const cards = document.querySelectorAll('.fila-grupo');
        if (cards.length <= 1) {
          alert('Debe haber al menos una fila');
          return;
        }
        const card = document.querySelector('.fila-grupo[data-id="' + id + '"]');
        if (card) card.remove();
        renumerarFilas();
        actualizarTotalGeneral();
      }

      function renumerarFilas() {
        let num = 1;
        document.querySelectorAll('.fila-grupo').forEach(card => {
          const numEl = card.querySelector('.venta-num');
          if (numEl) numEl.textContent = num++;
        });
      }
// MOD-004-012: FIN

// MOD-004-013: LIMPIAR FORMULARIO [INICIO]
      function limpiarFormulario() {
        if (!confirm('¬øEst√°s seguro de limpiar todos los campos?')) return;
        document.getElementById('formVentas').reset();
        document.querySelectorAll('.btn-categoria').forEach(b => b.classList.remove('activo'));
        document.querySelectorAll('.btn-medio-pago').forEach(b => b.classList.remove('activo'));
        categoriaSeleccionada   = null;
        medioPagoSeleccionado   = null;
        document.querySelectorAll('.fila-grupo').forEach(grupo => {
          const id = grupo.getAttribute('data-id');
          const t  = document.getElementById('total' + id);
          const c  = document.getElementById('cantidad' + id);
          if (t) t.value = '';
          if (c) c.value = '1';
        });
        actualizarTotalGeneral();
      }
// MOD-004-013: FIN

// MOD-004-014: REGISTRAR VENTAS - VALIDACI√ìN [INICIO]
      function registrarVentas(e) {
        e.preventDefault();
        const grupos = document.querySelectorAll('.fila-grupo');
        const filasProblematicas = [];
        const ventas = [];

        grupos.forEach((grupo, idx) => {
          const id         = grupo.getAttribute('data-id');
          const numVisible = idx + 1;
          const categoria      = document.getElementById('categoria'     + id)?.value || '';
          const producto       = (document.getElementById('producto'     + id)?.value || '').trim();
          const medioPago      = document.getElementById('medioPago'     + id)?.value || '';
          const precioUnitario = document.getElementById('precioUnitario'+ id)?.value || '';
          const cantidad       = document.getElementById('cantidad'      + id)?.value || '';
          const total          = document.getElementById('total'         + id)?.value || '';

          const tieneProducto  = producto       !== '';
          const tienePrecio    = precioUnitario !== '' && parseFloat(precioUnitario) > 0;
          const tieneMedioPago = medioPago      !== '';
          const tieneCantidad  = cantidad       !== '' && parseFloat(cantidad) > 0;

          if (tieneProducto || tienePrecio) {
            if (!tieneProducto || !tieneMedioPago || !tienePrecio || !tieneCantidad) {
              const faltantes = [];
              if (!tieneProducto)  faltantes.push('Producto');
              if (!tieneMedioPago) faltantes.push('Medio de Pago');
              if (!tienePrecio)    faltantes.push('Precio');
              if (!tieneCantidad)  faltantes.push('Cantidad');
              filasProblematicas.push({ numero: numVisible, faltantes });
            } else {
              ventas.push({ categoria, producto, medioPago, precioUnitario, cantidad, total });
            }
          }
        });

        if (filasProblematicas.length > 0) {
          let msg = '‚ö†Ô∏è Campos incompletos:\n\n';
          filasProblematicas.forEach(p => {
            msg += `Fila ${p.numero}: Falta(n) ${p.faltantes.join(', ')}\n`;
          });
          msg += '\nCompleta los campos o deja la fila vac√≠a.';
          mostrarMensaje(msg, 'error');
          return;
        }
        if (ventas.length === 0) {
          mostrarMensaje('‚ö†Ô∏è Completa al menos una venta.', 'error');
          return;
        }

        const mensajeDiv = document.getElementById('mensajeExito');
        mensajeDiv.textContent = '‚è≥ Guardando...';
        mensajeDiv.className = '';
        mensajeDiv.style.display = 'block';
        mensajeDiv.style.background = '#fff3cd';
        mensajeDiv.style.color = '#856404';

        google.script.run
          .withSuccessHandler(function(msg) {
            mostrarMensaje('‚úÖ ' + msg, 'ok');
            limpiarTrasGuardar();
          })
          .withFailureHandler(function(err) {
            mostrarMensaje('‚ùå Error: ' + err.message, 'error');
          })
          .registrarVentasMultiples(ventas);
      }
// MOD-004-014: FIN

// MOD-004-015: LIMPIAR TRAS GUARDAR [INICIO]
      function limpiarTrasGuardar() {
        document.getElementById('formVentas').reset();
        document.querySelectorAll('.btn-categoria').forEach(b => b.classList.remove('activo'));
        document.querySelectorAll('.btn-medio-pago').forEach(b => b.classList.remove('activo'));
        categoriaSeleccionada = null;
        medioPagoSeleccionado = null;
        document.querySelectorAll('.fila-grupo').forEach(grupo => {
          const id = grupo.getAttribute('data-id');
          const t  = document.getElementById('total'   + id);
          const c  = document.getElementById('cantidad'+ id);
          if (t) t.value = '';
          if (c) c.value = '1';
        });
        actualizarTotalGeneral();
      }
// MOD-004-015: FIN

// MOD-004-016: MOSTRAR MENSAJE [INICIO]
      function mostrarMensaje(texto, tipo) {
        const div = document.getElementById('mensajeExito');
        div.textContent = texto;
        div.className   = tipo;
        div.style.display = 'block';
        div.style.background = '';
        div.style.color = '';
        setTimeout(() => div.style.display = 'none', 5000);
      }
// MOD-004-016: FIN

// MOD-004-017: SUGERENCIAS PRODUCTOS POR CATEGOR√çA [INICIO]
      function cargarSugerenciasCategoria(idFila) {
        const selectCategoria = document.getElementById('categoria' + idFila);
        const inputProducto   = document.getElementById('producto'  + idFila);
        const datalistId      = 'sugerencias' + idFila;
        let datalist = document.getElementById(datalistId);
        if (!datalist) {
          datalist = document.createElement('datalist');
          datalist.id = datalistId;
          document.body.appendChild(datalist);
        }
        const categoria = selectCategoria ? selectCategoria.value.trim() : '';
        if (!categoria || categoria === 'Sin categor√≠a') {
          datalist.innerHTML = '';
          if (inputProducto) inputProducto.removeAttribute('list');
          return;
        }
        if (inputProducto) inputProducto.setAttribute('list', datalistId);
        google.script.run
          .withSuccessHandler(function(sugerencias) {
            datalist.innerHTML = '';
            if (sugerencias && sugerencias.length > 0) {
              sugerencias.forEach(p => {
                const o = document.createElement('option');
                o.value = p;
                datalist.appendChild(o);
              });
            }
          })
          .withFailureHandler(function() { datalist.innerHTML = ''; })
          .getProductosPorCategoriaTop20(categoria, 5000);
      }
// MOD-004-017: FIN

// MOD-004-018: WINDOW.ONLOAD [INICIO]
      window.onload = cargarListas;
// MOD-004-018: FIN
    </script>
<!-- MOD-004: FIN -->

<!-- MOD-005: CIERRE HEAD + BODY + BOT√ìN HOME [INICIO] -->
  </head>
  <body>
    <a href="https://script.google.com/macros/s/AKfycbxYPHS6S3oU3U6vM_qmlIFyn0JzrArYSPDYV5bYjQRTuqp3G4qWiew14Nlwzitf2fSF/exec?page=master"
       class="btn-home">
      <span>üè†</span>
      <span>Home</span>
    </a>
<!-- MOD-005: FIN -->

<!-- MOD-006: CONTAINER + SECCIONES [INICIO] -->
    <div class="container">
      <h2>üì± Venta M√≥vil</h2>

      <!-- Secci√≥n Categor√≠as (colapsable) -->
      <div class="seccion-colapsable">
        <div class="seccion-header" onclick="toggleSeccion('contenidoCat','flechaCat')">
          <span class="titulo">Categor√≠a para todos</span>
          <span class="flecha" id="flechaCat">‚ñº</span>
        </div>
        <div class="seccion-contenido" id="contenidoCat">
          <div id="botonesCategoria" class="botones-categoria"></div>
        </div>
      </div>

      <!-- Secci√≥n Medios de Pago (fija, no colapsable) -->
      <div class="seccion-fija">
        <span class="titulo">Medio de Pago para todos</span>
        <div id="botonesMediosPago" class="botones-medios-pago"></div>
      </div>
<!-- MOD-006: FIN -->

<!-- MOD-007: FORMULARIO + LISTA VENTAS 3 FILAS INICIALES [INICIO] -->
      <form id="formVentas" onsubmit="registrarVentas(event)">
        <div class="lista-ventas" id="listaVentas">

          <!-- VENTA 1 -->
          <div class="venta-card fila-grupo" data-id="1">
            <div class="venta-num">1</div>
            <div class="venta-col-izq">
              <span class="campo-label">Categor√≠a</span>
              <select id="categoria1" onchange="cargarSugerenciasCategoria(1)"></select>
              <span class="campo-label" style="margin-top:4px;">Medio de Pago</span>
              <select id="medioPago1"></select>
            </div>
            <div class="venta-col-der">
              <input type="text" id="producto1" list="sugerencias1" placeholder="Producto">
              <input type="number" id="precioUnitario1" step="any" min="0.01" placeholder="S/ Precio" oninput="calcularTotal(1)">
              <div class="cantidad-ctrl">
                <button type="button" class="btn-cant" onclick="cambiarCantidad(1,-1)">‚àí</button>
                <input type="number" id="cantidad1" class="input-cantidad" value="1" step="any" min="0.01" oninput="calcularTotal(1)">
                <button type="button" class="btn-cant" onclick="cambiarCantidad(1,1)">+</button>
                <span class="igual-signo">=</span>
                <input type="text" id="total1" class="input-subtotal" readonly>
              </div>
            </div>
            <div class="venta-del">
              <a href="javascript:void(0)" class="btn-eliminar-fila" onclick="eliminarFila(1)">üóëÔ∏è</a>
            </div>
          </div>

          <!-- VENTA 2 -->
          <div class="venta-card fila-grupo" data-id="2">
            <div class="venta-num">2</div>
            <div class="venta-col-izq">
              <span class="campo-label">Categor√≠a</span>
              <select id="categoria2" onchange="cargarSugerenciasCategoria(2)"></select>
              <span class="campo-label" style="margin-top:4px;">Medio de Pago</span>
              <select id="medioPago2"></select>
            </div>
            <div class="venta-col-der">
              <input type="text" id="producto2" list="sugerencias2" placeholder="Producto">
              <input type="number" id="precioUnitario2" step="any" min="0.01" placeholder="S/ Precio" oninput="calcularTotal(2)">
              <div class="cantidad-ctrl">
                <button type="button" class="btn-cant" onclick="cambiarCantidad(2,-1)">‚àí</button>
                <input type="number" id="cantidad2" class="input-cantidad" value="1" step="any" min="0.01" oninput="calcularTotal(2)">
                <button type="button" class="btn-cant" onclick="cambiarCantidad(2,1)">+</button>
                <span class="igual-signo">=</span>
                <input type="text" id="total2" class="input-subtotal" readonly>
              </div>
            </div>
            <div class="venta-del">
              <a href="javascript:void(0)" class="btn-eliminar-fila" onclick="eliminarFila(2)">üóëÔ∏è</a>
            </div>
          </div>

          <!-- VENTA 3 -->
          <div class="venta-card fila-grupo" data-id="3">
            <div class="venta-num">3</div>
            <div class="venta-col-izq">
              <span class="campo-label">Categor√≠a</span>
              <select id="categoria3" onchange="cargarSugerenciasCategoria(3)"></select>
              <span class="campo-label" style="margin-top:4px;">Medio de Pago</span>
              <select id="medioPago3"></select>
            </div>
            <div class="venta-col-der">
              <input type="text" id="producto3" list="sugerencias3" placeholder="Producto">
              <input type="number" id="precioUnitario3" step="any" min="0.01" placeholder="S/ Precio" oninput="calcularTotal(3)">
              <div class="cantidad-ctrl">
                <button type="button" class="btn-cant" onclick="cambiarCantidad(3,-1)">‚àí</button>
                <input type="number" id="cantidad3" class="input-cantidad" value="1" step="any" min="0.01" oninput="calcularTotal(3)">
                <button type="button" class="btn-cant" onclick="cambiarCantidad(3,1)">+</button>
                <span class="igual-signo">=</span>
                <input type="text" id="total3" class="input-subtotal" readonly>
              </div>
            </div>
            <div class="venta-del">
              <a href="javascript:void(0)" class="btn-eliminar-fila" onclick="eliminarFila(3)">üóëÔ∏è</a>
            </div>
          </div>

        </div>
<!-- MOD-007: FIN -->

<!-- MOD-008: BOTONES + RESUMEN + MENSAJE [INICIO] -->
        <div class="botones-filas">
          <button type="button" class="btn-agregar" onclick="agregarFila()">+ Agregar venta</button>
        </div>

        <div class="resumen-total">
          <div class="label">TOTAL GENERAL:</div>
          <div class="monto" id="totalGeneral">S/ 0.00</div>
        </div>

        <div class="botones-principales">
          <button type="submit" class="btn-guardar">üíæ Guardar</button>
          <button type="button" class="btn-limpiar" onclick="limpiarFormulario()">üóëÔ∏è Limpiar</button>
        </div>
      </form>

      <div id="mensajeExito"></div>
    </div>
<!-- MOD-008: FIN -->

<!-- MOD-009: CIERRE HTML [INICIO] -->
  </body>
</html>
<!-- MOD-009: FIN -->

<!-- MOD-099: NOTAS [INICIO] -->
<!--
DESCRIPCI√ìN:
Movilw.html - Registro m√∫ltiple de ventas optimizado para m√≥vil v1.03.
Layout flexbox por venta-card. Sin tabla. Col izq: Categor√≠a+MedioPago.
Col der: Producto+Precio+Cantidad. Medios de Pago siempre visibles.

ESTRUCTURA:
- MOD-003: CSS (15 subm√≥dulos ‚Äî MOD-003-008 eliminado)
- MOD-004: JS (18 subm√≥dulos)
- MOD-006: Secci√≥n colapsable categor√≠a + secci√≥n fija medios pago
- MOD-007: Lista flexbox 3 ventas iniciales (id=listaVentas)
- MOD-008: Botones + resumen + mensaje

DEPENDENCIAS GAS (sin Movil.gs, reutiliza Multiventa.gs + Master.gs):
- getCategorias(), getCategoriasBoton(), getMediosPago()
- registrarVentasMultiples(), getProductosPorCategoriaTop20()

RUTA: ?page=movil (Master.gs MOD-003)
-->
<!-- MOD-099: FIN -->